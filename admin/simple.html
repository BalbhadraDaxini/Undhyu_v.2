<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Undhyu Admin - Simple</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div id="app">
        <!-- Login Page -->
        <div id="loginPage" class="min-h-screen flex items-center justify-center">
            <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-md">
                <h1 class="text-2xl font-bold text-center mb-6">Undhyu Admin</h1>
                <form id="loginForm" class="space-y-4">
                    <input type="email" id="email" value="admin@undhyu.com" 
                           placeholder="Email" class="w-full px-4 py-2 border rounded-lg" required>
                    <input type="password" id="password" value="admin123" 
                           placeholder="Password" class="w-full px-4 py-2 border rounded-lg" required>
                    <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                        Login
                    </button>
                </form>
                <div id="loginStatus" class="mt-4 text-sm text-center"></div>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminPage" class="hidden min-h-screen">
            <div class="bg-white shadow-sm border-b p-4">
                <div class="flex justify-between items-center">
                    <h1 class="text-xl font-bold">Undhyu Admin Dashboard</h1>
                    <button id="logoutBtn" class="bg-red-500 text-white px-4 py-2 rounded">Logout</button>
                </div>
            </div>

            <div class="p-6">
                <!-- Add Product Form -->
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h2 class="text-lg font-semibold mb-4">Add New Product</h2>
                    <form id="productForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input type="text" id="productName" placeholder="Product Name" class="px-3 py-2 border rounded" required>
                            <select id="productCategory" class="px-3 py-2 border rounded" required>
                                <option value="">Select Category</option>
                                <option value="Designer Sarees">Designer Sarees</option>
                                <option value="Royal Lehengas">Royal Lehengas</option>
                                <option value="Designer Kurtis">Designer Kurtis</option>
                                <option value="Premium Jewelry">Premium Jewelry</option>
                            </select>
                            <input type="number" id="productPrice" placeholder="Price" class="px-3 py-2 border rounded" required>
                            <input type="number" id="productOriginalPrice" placeholder="Original Price" class="px-3 py-2 border rounded">
                            <input type="number" id="productStock" placeholder="Stock Quantity" class="px-3 py-2 border rounded" required>
                            <input type="text" id="productMaterial" placeholder="Material" class="px-3 py-2 border rounded">
                            <input type="text" id="productOrigin" placeholder="Origin" class="px-3 py-2 border rounded">
                            <input type="text" id="productSizes" placeholder="Sizes (S, M, L)" class="px-3 py-2 border rounded">
                            <input type="text" id="productColors" placeholder="Colors (Red, Blue)" class="px-3 py-2 border rounded">
                        </div>
                        <textarea id="productDescription" placeholder="Product Description" class="w-full px-3 py-2 border rounded h-20" required></textarea>
                        <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">
                            Add Product
                        </button>
                    </form>
                    <div id="productStatus" class="mt-4 text-sm"></div>
                </div>

                <!-- Products List -->
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-semibold">Products</h2>
                        <button id="refreshProducts" class="bg-blue-500 text-white px-4 py-2 rounded">Refresh</button>
                    </div>
                    <div id="productsList">Loading...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://54a1d159-397c-45f6-b43d-7c17eb879b5c.preview.emergentagent.com';
        let adminToken = null;

        // DOM elements
        const loginPage = document.getElementById('loginPage');
        const adminPage = document.getElementById('adminPage');
        const loginForm = document.getElementById('loginForm');
        const productForm = document.getElementById('productForm');
        const loginStatus = document.getElementById('loginStatus');
        const productStatus = document.getElementById('productStatus');
        const productsList = document.getElementById('productsList');

        // Check existing login
        const savedToken = localStorage.getItem('adminToken');
        if (savedToken) {
            adminToken = savedToken;
            showAdminPage();
        }

        // Login handler
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            loginStatus.innerHTML = '<span class="text-blue-600">Logging in...</span>';

            try {
                const response = await fetch(`${API_BASE}/api/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                
                if (response.ok && data.token) {
                    if (data.user && data.user.is_admin) {
                        adminToken = data.token;
                        localStorage.setItem('adminToken', adminToken);
                        loginStatus.innerHTML = '<span class="text-green-600">Login successful!</span>';
                        setTimeout(showAdminPage, 500);
                    } else {
                        loginStatus.innerHTML = '<span class="text-red-600">Access denied: Admin privileges required</span>';
                    }
                } else {
                    loginStatus.innerHTML = `<span class="text-red-600">Login failed: ${data.detail || 'Invalid credentials'}</span>`;
                }
            } catch (error) {
                console.error('Login error:', error);
                loginStatus.innerHTML = '<span class="text-red-600">Network error. Please try again.</span>';
            }
        });

        // Product form handler
        productForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const productData = {
                name: document.getElementById('productName').value,
                category: document.getElementById('productCategory').value,
                price: parseFloat(document.getElementById('productPrice').value),
                original_price: parseFloat(document.getElementById('productOriginalPrice').value) || null,
                stock: parseInt(document.getElementById('productStock').value),
                material: document.getElementById('productMaterial').value || '',
                origin: document.getElementById('productOrigin').value || '',
                sizes: document.getElementById('productSizes').value ? 
                    document.getElementById('productSizes').value.split(',').map(s => s.trim()) : [],
                colors: document.getElementById('productColors').value ? 
                    document.getElementById('productColors').value.split(',').map(c => c.trim()) : [],
                description: document.getElementById('productDescription').value,
                images: ['https://images.unsplash.com/photo-1609748340041-f5d61e061ebc'],
                is_featured: true
            };

            productStatus.innerHTML = '<span class="text-blue-600">Adding product...</span>';

            try {
                const response = await fetch(`${API_BASE}/api/products`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${adminToken}`
                    },
                    body: JSON.stringify(productData)
                });

                const result = await response.json();
                
                if (response.ok) {
                    productStatus.innerHTML = '<span class="text-green-600">Product added successfully!</span>';
                    productForm.reset();
                    loadProducts();
                } else {
                    productStatus.innerHTML = `<span class="text-red-600">Failed: ${result.detail || 'Unknown error'}</span>`;
                }
            } catch (error) {
                console.error('Product creation error:', error);
                productStatus.innerHTML = '<span class="text-red-600">Network error while adding product</span>';
            }
        });

        // Load products
        async function loadProducts() {
            productsList.innerHTML = 'Loading products...';
            
            try {
                const response = await fetch(`${API_BASE}/api/products`);
                const products = await response.json();
                
                if (response.ok) {
                    if (products.length === 0) {
                        productsList.innerHTML = '<p class="text-gray-500">No products found. Add your first product above.</p>';
                    } else {
                        productsList.innerHTML = products.map(product => `
                            <div class="border rounded p-4 mb-2 flex justify-between items-center">
                                <div>
                                    <h3 class="font-semibold">${product.name}</h3>
                                    <p class="text-sm text-gray-600">${product.category} - ₹${product.price}</p>
                                    <p class="text-xs text-gray-500">Stock: ${product.stock || 0}</p>
                                </div>
                                <button onclick="deleteProduct('${product.id}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm">
                                    Delete
                                </button>
                            </div>
                        `).join('');
                    }
                } else {
                    productsList.innerHTML = '<p class="text-red-500">Failed to load products</p>';
                }
            } catch (error) {
                console.error('Load products error:', error);
                productsList.innerHTML = '<p class="text-red-500">Error loading products</p>';
            }
        }

        // Delete product
        window.deleteProduct = async function(productId) {
            if (!confirm('Are you sure you want to delete this product?')) return;
            
            try {
                const response = await fetch(`${API_BASE}/api/products/${productId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${adminToken}` }
                });

                if (response.ok) {
                    loadProducts();
                } else {
                    alert('Failed to delete product');
                }
            } catch (error) {
                alert('Error deleting product');
            }
        };

        // Show admin page
        function showAdminPage() {
            loginPage.classList.add('hidden');
            adminPage.classList.remove('hidden');
            loadProducts();
        }

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('adminToken');
            adminToken = null;
            adminPage.classList.add('hidden');
            loginPage.classList.remove('hidden');
            loginStatus.innerHTML = '';
        });

        // Refresh products
        document.getElementById('refreshProducts').addEventListener('click', loadProducts);
    </script>
</body>
</html>